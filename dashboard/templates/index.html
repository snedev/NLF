{% extends "base.html" %}

{% block content %}

{% load static %}
<!-- JQuery -->
        <script type="text/javascript" src="{% static 'js/jquery-3.4.1.min.js' %}"></script>
        <!-- Bootstrap tooltips -->
        <script type="text/javascript" src="{% static 'js/popper.min.js' %}"></script>
        <!-- Bootstrap core JavaScript -->
        <script type="text/javascript" src="{% static 'js/bootstrap.min.js' %}"></script>
        <!-- MDB core JavaScript -->
         <script type="text/javascript" src="{% static 'js/mdb.min.js' %}"></script>
        <!-- Plotly.js -->
        <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
<script>
var jsdata = [];
$(function () {
    var frm = $('#data_selector');
    frm.submit(function (ev) {
        $.ajax({
            type: frm.attr('method'),
            url: frm.attr('action'),
            data: frm.serialize(),
            success: function (data) {
                jsdata.push(data);
            var graphDiv = document.getElementById('graphDiv');
            var traces = [];
            for (var key in data) {
                if (key !== 'time') {
                var trace = {
                    x: Object.values(data['time']),
                    y: Object.values(data[key]),
                    name: key
                };
                traces.push(trace);
            }}
            var layout = {
                    overlaying: 'y'
                };
            for (var i = 0; i < traces.length; i++) {
                traces[i].yaxis = 'y' + (i + 1);
                if (i > 0) {
                   layout['yaxis' + (i + 1)] =  {
                       overlaying: 'y',
                       side: 'right'
                   }}
            }
	        Plotly.newPlot( graphDiv, traces, layout);
            }
        });
        ev.preventDefault();
    });
});
</script>
<script>
$(function () {
    var frm = $('#nlu_selector');
    frm.submit(function (ev) {
        $.ajax({
            type: frm.attr('method'),
            url: frm.attr('action'),
            data: frm.serialize(),
            success: function (data) {
                jsdata.push(data);
            var graphDiv = document.getElementById('graphDiv');
            var traces = [];
            for (var key in data) {
                if (key !== 'time') {
                var trace = {
                x: Object.values(data['time']),
                y: Object.values(data[key]),
                name: key
                };
                traces.push(trace);
            }}
            var input = $("<input>", { type: "hidden", name: "plot_data", value: JSON.stringify(jsdata) });
            $('#nlu_selector').append($(input));
	        Plotly.newPlot( graphDiv, traces);
            }
        });
        ev.preventDefault();
    });
});
</script>

<div class="container">

    <h1>Select a Currency Pair and a Date Range</h1>

    <form id="data_selector" action="/data" method="post">
    {% csrf_token %}
        <select name="currency_pairs" multiple>
            <option value="" disabled selected>Choose currency pairs</option>
            <option value="{{ cpairs.AUDCAD }}">{{ cpairs.AUDCAD }}</option>
            <option value="{{ cpairs.AUDCHF }}">{{ cpairs.AUDCHF }}</option>
            <option value="{{ cpairs.AUDJPY }}">{{ cpairs.AUDJPY }}</option>
            <option value="{{ cpairs.AUDNZD }}">{{ cpairs.AUDNZD }}</option>
            <option value="{{ cpairs.AUDSEK }}">{{ cpairs.AUDSEK }}</option>
            <option value="{{ cpairs.AUDSGD }}">{{ cpairs.AUDSGD }}</option>
            <option value="{{ cpairs.AUDUSD }}">{{ cpairs.AUDUSD }}</option>
            <option value="{{ cpairs.CADCHF }}">{{ cpairs.CADCHF }}</option>
            <option value="{{ cpairs.CADJPY }}">{{ cpairs.CADJPY }}</option>
            <option value="{{ cpairs.CADNOK }}">{{ cpairs.CADNOK }}</option>
            <option value="{{ cpairs.CADSEK }}">{{ cpairs.CADSEK }}</option>
            <option value="{{ cpairs.CHFJPY }}">{{ cpairs.CHFJPY }}</option>
            <option value="{{ cpairs.CHFNOK }}">{{ cpairs.CHFNOK }}</option>
            <option value="{{ cpairs.CHFSEK }}">{{ cpairs.CHFSEK }}</option>
            <option value="{{ cpairs.DKKSEK }}">{{ cpairs.DKKSEK }}</option>
            <option value="{{ cpairs.EURAUD }}">{{ cpairs.EURAUD }}</option>
            <option value="{{ cpairs.EURCAD }}">{{ cpairs.EURCAD }}</option>
            <option value="{{ cpairs.EURCHF }}">{{ cpairs.EURCHF }}</option>
            <option value="{{ cpairs.EURCNH }}">{{ cpairs.EURCNH }}</option>
            <option value="{{ cpairs.EURCZK }}">{{ cpairs.EURCZK }}</option>
            <option value="{{ cpairs.EURDKK }}">{{ cpairs.EURDKK }}</option>
            <option value="{{ cpairs.EURGBP }}">{{ cpairs.EURGBP }}</option>
            <option value="{{ cpairs.EURHUF }}">{{ cpairs.EURHUF }}</option>
            <option value="{{ cpairs.EURJPY }}">{{ cpairs.EURJPY }}</option>
            <option value="{{ cpairs.EURMXN }}">{{ cpairs.EURMXN }}</option>
            <option value="{{ cpairs.EURNOK }}">{{ cpairs.EURNOK }}</option>
            <option value="{{ cpairs.EURNZD }}">{{ cpairs.EURNZD }}</option>
            <option value="{{ cpairs.EURPLN }}">{{ cpairs.EURPLN }}</option>
            <option value="{{ cpairs.EURSEK }}">{{ cpairs.EURSEK }}</option>
            <option value="{{ cpairs.EURSGD }}">{{ cpairs.EURSGD }}</option>
            <option value="{{ cpairs.EURTRY }}">{{ cpairs.EURTRY }}</option>
            <option value="{{ cpairs.EURUSD }}">{{ cpairs.EURUSD }}</option>
            <option value="{{ cpairs.GBPAUD }}">{{ cpairs.GBPAUD }}</option>
            <option value="{{ cpairs.GBPCAD }}">{{ cpairs.GBPCAD }}</option>
            <option value="{{ cpairs.GBPCHF }}">{{ cpairs.GBPCHF }}</option>
            <option value="{{ cpairs.GBPJPY }}">{{ cpairs.GBPJPY }}</option>
            <option value="{{ cpairs.GBPMXN }}">{{ cpairs.GBPMXN }}</option>
            <option value="{{ cpairs.GBPNOK }}">{{ cpairs.GBPNOK }}</option>
            <option value="{{ cpairs.GBPNZD }}">{{ cpairs.GBPNZD }}</option>
            <option value="{{ cpairs.GBPSEK }}">{{ cpairs.GBPSEK }}</option>
            <option value="{{ cpairs.GBPSGD }}">{{ cpairs.GBPSGD }}</option>
            <option value="{{ cpairs.GBPUSD }}">{{ cpairs.GBPUSD }}</option>
            <option value="{{ cpairs.NOKDKK }}">{{ cpairs.NOKDKK }}</option>
            <option value="{{ cpairs.NOKJPY }}">{{ cpairs.NOKJPY }}</option>
            <option value="{{ cpairs.NOKSEK }}">{{ cpairs.NOKSEK }}</option>
            <option value="{{ cpairs.NZDCAD }}">{{ cpairs.NZDCAD }}</option>
            <option value="{{ cpairs.NZDCHF }}">{{ cpairs.NZDCHF }}</option>
            <option value="{{ cpairs.NZDJPY }}">{{ cpairs.NZDJPY }}</option>
            <option value="{{ cpairs.NZDNOK }}">{{ cpairs.NZDNOK }}</option>
            <option value="{{ cpairs.NZDSEK }}">{{ cpairs.NZDSEK }}</option>
            <option value="{{ cpairs.NZDUSD }}">{{ cpairs.NZDUSD }}</option>
            <option value="{{ cpairs.PLNHUF }}">{{ cpairs.PLNHUF }}</option>
            <option value="{{ cpairs.SGDJPY }}">{{ cpairs.SGDJPY }}</option>
            <option value="{{ cpairs.USDCAD }}">{{ cpairs.USDCAD }}</option>
            <option value="{{ cpairs.USDCHF }}">{{ cpairs.USDCHF }}</option>
            <option value="{{ cpairs.USDCNH }}">{{ cpairs.USDCNH }}</option>
            <option value="{{ cpairs.USDCZK }}">{{ cpairs.USDCZK }}</option>
            <option value="{{ cpairs.USDDKK }}">{{ cpairs.USDDKK }}</option>
            <option value="{{ cpairs.USDHKD }}">{{ cpairs.USDHKD }}</option>
            <option value="{{ cpairs.USDHUF }}">{{ cpairs.USDHUF }}</option>
            <option value="{{ cpairs.USDILS }}">{{ cpairs.USDILS }}</option>
            <option value="{{ cpairs.USDJPY }}">{{ cpairs.USDJPY }}</option>
            <option value="{{ cpairs.USDMXN }}">{{ cpairs.USDMXN }}</option>
            <option value="{{ cpairs.USDNOK }}">{{ cpairs.USDNOK }}</option>
            <option value="{{ cpairs.USDPLN }}">{{ cpairs.USDPLN }}</option>
            <option value="{{ cpairs.USDRON }}">{{ cpairs.USDRON }}</option>
            <option value="{{ cpairs.USDRUB }}">{{ cpairs.USDRUB }}</option>
            <option value="{{ cpairs.USDSEK }}">{{ cpairs.USDSEK }}</option>
            <option value="{{ cpairs.USDSGD }}">{{ cpairs.USDSGD }}</option>
            <option value="{{ cpairs.USDTHB }}">{{ cpairs.USDTHB }}</option>
            <option value="{{ cpairs.USDTRY }}">{{ cpairs.USDTRY }}</option>
            <option value="{{ cpairs.USDZAR }}">{{ cpairs.USDZAR }}</option>
            <option value="{{ cpairs.XAGUSD }}">{{ cpairs.XAGUSD }}</option>
            <option value="{{ cpairs.XAUUSD }}">{{ cpairs.XAUUSD }}</option>
            <option value="{{ cpairs.XPDUSD }}">{{ cpairs.XPDUSD }}</option>
            <option value="{{ cpairs.XPTUSD }}">{{ cpairs.XPTUSD }}</option>
            <option value="{{ cpairs.ZARJPY }}">{{ cpairs.ZARJPY }}</option>
        </select>
<!--        <div id="currencies">-->
<!--            <input type="checkbox" name="currency_pairs" id="{{ cpairs.Bitcoin }}" value="{{ cpairs.Bitcoin }}">-->
<!--                <label for="{{ cpairs.Bitcoin }}">{{ cpairs.Bitcoin }}</label>-->
<!--            <input type="checkbox" name="currency_pairs" id="{{ cpairs.Ethereum }}" value="{{ cpairs.Ethereum }}">-->
<!--                <label for="{{ cpairs.Ethereum }}">{{ cpairs.Ethereum }}</label>-->
<!--            <input type="checkbox" name="currency_pairs" id="{{ cpairs.Litecoin }}" value="{{ cpairs.Litecoin }}">-->
<!--                <label for="{{ cpairs.Litecoin }}">{{ cpairs.Litecoin }}</label>-->
<!--            <input type="checkbox" name="currency_pairs" id="{{ cpairs.Ripple }}" value="{{ cpairs.Ripple }}">-->
<!--                <label for="{{ cpairs.Ripple }}">{{ cpairs.Ripple }}</label>-->
<!--            <input type="checkbox" name="currency_pairs" id="{{ cpairs.EURUSD }}" value="{{ cpairs.EURUSD }}">-->
<!--                <label for="{{ cpairs.EURUSD }}">{{ cpairs.EURUSD }}</label>-->
<!--        </div>-->

        <div id="date">
            <p> From: <input type="datetime-local" name="date_from" form="data_selector">
                To: <input type="datetime-local" name="date_to" form="data_selector">
            </p>
        </div>

        <div id="data_analysis">
            <h2>Instruments</h2>
            <input type="checkbox" name="data_analysis" id="MA21" form="data_selector" value="ma21">
                <label for="ma21">MA21</label>
            <input type="checkbox" name="data_analysis" id="MA100" form="data_selector" value="ma100">
                <label for="ma100">MA100</label>
            <input type="checkbox" name="data_analysis" id="MACD" form="data_selector" value="macd">
                <label for="macd">MACD</label>
        </div>

        <input type="submit" id="submit" value="Submit">
    </form>
    <div id="nlu_container">
        <form id="nlu_selector" action="/nlu" method="post">
        {% csrf_token %}
        <div id="nlu_form">
            <h1>Type in a query..</h1>
            <input type="text" name="nlu_text" id="nlu_text" form="nlu_selector" size="80" placeholder="Ex. Plot me the Bitcoin price from 25th December 2017 to 20th January 2018">
            <input type="submit" id="submit_nlu" value="Submit">
        </div>
        </form>
    </div>
  <!-- Plotly.js -->

    <div id="graphDiv"><!-- The Plotly chart goes here --></div>

</div>

{% endblock %}